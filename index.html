<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PrimeNumbers</title>
<link rel="manifest" href="manifest.json">
<script>
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('service-worker.js').then(() => {
    console.log("Service Worker Registered");
  });
}
</script>
<style>
body {font-family:'Calibri',Tahoma,sans-serif; direction:rtl; text-align:center; margin:0; padding:10px; color:#4B0082; transition:background 1s;}
h2 {font-weight:bold; font-size:22px; margin-bottom:10px; background:#000; color:#fff; padding:10px; border-radius:8px; display:inline-block;}
label {font-weight:bold; font-size:18px; display:block; margin:10px 0 5px; background:#ccc; color:#9370DB; border-radius:6px; padding:6px;}
input[type=number]{width:80px; padding:5px; margin:5px; font-size:16px; font-weight:bold;}
button{padding:8px 16px; margin:5px; font-size:16px; font-weight:bold; cursor:pointer;}
.primes-grid{display:grid; grid-template-columns:repeat(5,1fr); gap:4px; justify-items:center; margin-top:10px; direction:ltr;}
.prime{padding:6px 10px; border-radius:4px; display:inline-block; color:white; font-size:16px; min-width:40px; font-weight:bold;}
#primesBox, #primeAtBox, #checkBox, #surroundingBox, #rankBox{margin-top:10px; word-wrap:break-word; font-size:18px; font-weight:bold;}
#factorsBox{direction:ltr; display:inline-block; background:#ccc; color:#9370DB; border-radius:6px; font-weight:bold; margin-top:10px; font-size:18px; padding:4px 8px; white-space:nowrap;}
#factorsBox .prime{padding:2px 4px; border-radius:4px; display:inline-flex; color:white; font-size:16px; font-weight:bold; min-width:unset;}
footer{margin-top:20px; padding:10px; background:#333; color:white; font-size:16px; border-radius:8px; font-weight:bold;}
</style>
</head>
<body>
<h2>🧮 توليد وتحليل الأعداد الأولية</h2>
<div>
  <label>أدخل رقم n لإيجاد كل الأعداد الأولية الأصغر منه:</label>
  <input type="number" id="n" value="100">
  <button onclick="gP()">اعرض الأعداد الأولية</button>
  <div id="primesBox" class="primes-grid"></div>
</div>
<hr>
<div>
  <label>أدخل ترتيب k لإيجاد العدد الأولي في هذا الترتيب:</label>
  <input type="number" id="k" value="10">
  <button onclick="gPA()">اعرض العدد الأولي</button>
  <div id="primeAtBox"></div>
</div>
<hr>
<div>
  <label>اختبر إذا كان عدد m أوليًا:</label>
  <input type="number" id="m" value="37">
  <button onclick="cP()">اختبر</button>
  <div id="checkBox"></div>
</div>
<hr>
<div>
  <label>أدخل عددا لإيجاد العددين الأوليين الأقرب المحصور بينهما:</label>
  <input type="number" id="x" value="50">
  <button onclick="fSP()">اعرض العددين</button>
  <div id="surroundingBox"></div>
</div>
<hr>
<div>
  <label>أدخل عددا  لإيجاد رتبته إذا كان أوليًا، أو العددين الأوليين الأقرب ورتبتهما:</label>
  <input type="number" id="y" value="20">
  <button onclick="fR()">اعرض الرتبة</button>
  <div id="rankBox"></div>
</div>
<hr>
<div>
  <label>أدخل عددا لتحليله إلى عوامله الأولية:</label>
  <input type="number" id="z" value="120">
  <button onclick="fZ()">حلل</button>
  <div id="factorsBox"></div>
</div>

<button style="background-color: #4CAF50; color: white; padding: 10px 20px; border: none; border-radius: 8px; cursor: pointer; font-size: 16px;">
  <a href="tree_factors.html" style="color: white; text-decoration: none;">شجرة العوامل🌿</a>
</button>

<script>
let deferredPrompt;
window.addEventListener('beforeinstallprompt', (e) => {
  e.preventDefault();
  deferredPrompt = e;
  const installBtn = document.createElement('button');
  installBtn.innerText = '📲 تثبيت التطبيق';
  installBtn.style.cssText = 'margin-top:10px; padding:8px 16px; font-size:16px;';
  document.body.appendChild(installBtn);
  installBtn.addEventListener('click', () => {
    deferredPrompt.prompt();
    deferredPrompt.userChoice.then((choiceResult) => {
      if (choiceResult.outcome === 'accepted') {
        console.log('User accepted the install prompt');
      } else {
        console.log('User dismissed the install prompt');
      }
      deferredPrompt = null;
    });
  });
});
</script>

<footer>
  <marquee direction="right" scrollamount="5">
    محمود عادل صالح – معلم رياضيات
    <a href="https://www.facebook.com/barghouthean?mibextid=ZbWKwL" target="_blank" style="margin-right:10px;">
      <img src="https://upload.wikimedia.org/wikipedia/commons/5/51/Facebook_f_logo_%282019%29.svg" width="20" style="vertical-align:middle;">
    </a>
  </marquee>
</footer>

<script>
// Improved function to check if a number is prime
function iP(n) {
  if (n <= 1) return false;
  if (n <= 3) return true;
  if (n % 2 === 0 || n % 3 === 0) return false;
  let s = Math.sqrt(n);
  for (let i = 5; i <= s; i += 6) {
    if (n % i === 0 || n % (i + 2) === 0) return false;
  }
  return true;
}

// Function to get a color based on the last digit of the prime number
function cD(d) {
  switch (d) {
    case 1: return "#8B4513"; // Brown
    case 3: return "green";
    case 7: return "orange";
    case 9: return "red";
    case 2: return "purple";
    case 5: return "blue";
    default: return "#555";
  }
}

// Function to format a prime number for display
function pS(p) {
  let c = cD(p % 10);
  return `<span class="prime" style="background:${c}">${p}</span>`;
}

// Function to display all primes less than n
function gP() {
  const n = +document.getElementById('n').value;
  if (n <= 2) {
    document.getElementById('primesBox').innerHTML = 'أدخل رقمًا أكبر من 2.';
    return;
  }
  const primes = [];
  for (let i = 2; i < n; i++) {
    if (iP(i)) {
      primes.push(i);
    }
  }
  document.getElementById('primesBox').innerHTML = primes.map(pS).join('');
}

// Function to find the k-th prime number
function gPA() {
  const k = +document.getElementById('k').value;
  if (k < 1) {
    document.getElementById('primeAtBox').innerHTML = 'أدخل رقمًا موجبًا.';
    return;
  }
  let count = 0;
  let num = 1;
  while (count < k) {
    num++;
    if (iP(num)) {
      count++;
    }
  }
  document.getElementById('primeAtBox').innerHTML = `العدد الأولي رقم ${k} هو: ${pS(num)}`;
}

// Function to check if a number is prime
function cP() {
  const m = +document.getElementById('m').value;
  const result = iP(m) ? 'عدد أولي' : 'ليس عددًا أوليًا';
  document.getElementById('checkBox').innerHTML = `${pS(m)} : ${result}`;
}

// Function to find the primes surrounding a number
function fSP() {
  const x = +document.getElementById('x').value;
  if (x <= 2) {
    document.getElementById('surroundingBox').innerHTML = 'أدخل رقمًا أكبر من 2.';
    return;
  }
  let lowerPrime = x - 1;
  let upperPrime = x + 1;
  while (lowerPrime > 1 && !iP(lowerPrime)) {
    lowerPrime--;
  }
  while (!iP(upperPrime)) {
    upperPrime++;
  }
  document.getElementById('surroundingBox').innerHTML = `الأقرب: ${pS(lowerPrime)} ${pS(upperPrime)}`;
}

// Function to find the rank of a prime or the surrounding primes' ranks
function fR() {
  const y = +document.getElementById('y').value;
  if (y <= 1) {
    document.getElementById('rankBox').innerHTML = 'أدخل رقمًا أكبر من 1.';
    return;
  }
  if (iP(y)) {
    let count = 0;
    for (let i = 2; i <= y; i++) {
      if (iP(i)) count++;
    }
    document.getElementById('rankBox').innerHTML = `${pS(y)} هو العدد الأولي رقم ${count}`;
  } else {
    let lowerPrime = y - 1;
    let upperPrime = y + 1;
    while (lowerPrime > 1 && !iP(lowerPrime)) {
      lowerPrime--;
    }
    while (!iP(upperPrime)) {
      upperPrime++;
    }
    let lowerRank = 0;
    let upperRank = 0;
    let count = 0;
    for (let i = 2; i <= upperPrime; i++) {
      if (iP(i)) {
        count++;
        if (i === lowerPrime) lowerRank = count;
        if (i === upperPrime) upperRank = count;
      }
    }
    document.getElementById('rankBox').innerHTML = `${y} ليس أوليًا.<br>الأقرب: ${pS(lowerPrime)} رتبته ${lowerRank} ، و ${pS(upperPrime)} رتبته ${upperRank}`;
  }
}

// Function to find prime factors
function fZ() {
  const z = +document.getElementById('z').value;
  if (z <= 1) {
    document.getElementById('factorsBox').innerHTML = 'أدخل رقمًا أكبر من 1.';
    return;
  }
  let n = z;
  const factors = [];
  for (let i = 2; i <= n; i++) {
    while (n % i === 0) {
      factors.push(i);
      n /= i;
    }
  }
  document.getElementById('factorsBox').innerHTML = `${z} = ` + factors.map(pS).join(' × ');
}

// Background color animation
const colors = ["#000000", "#B9F2FF"];
let colorIndex = 0;
setInterval(() => {
  document.body.style.background = colors[colorIndex];
  colorIndex = (colorIndex + 1) % colors.length;
}, 6000);
</script>
</body>
</html>
